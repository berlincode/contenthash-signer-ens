<!DOCTYPE html>
<html class="" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>Ipfs-Signer Example</title>

    <script type="text/javascript" src="assets/js/require.js"></script>

    <style>
input[type='text']{ 
    width: 775px;
}
    </style>
</head>
<body>
    <h1>Ipfs-Signer Example</h1>
    <p>
        This is the online example of <a href="https://github.com/berlincode/ipfs-signer">https://github.com/berlincode/ipfs-signer</a>
    </p>

    <p>
        There is a companion tool to <a href="contenthash_converter.html">convert between IPFS CIDs and multicodec contenthashes</a>.
    </p>

    <h2>Sign content</h2>
    <form>
        <div>
            Private key:
            <input id="signPrivateKey" value="0xdc68bd96144c2963602d86b054ad67fd62d488edd78fecf44aa8d8cd90d59f35" placeholder="0xdc68bd96144c2963602d86b054ad67fd62d488edd78fecf44aa8d8cd90d59f35" type="text">
        </div>
        <div>
            IPFS CID/hash:
            <input id="signCid" value="QmeT9K2A9hqhtGa2RvXNopE6SD58gfvrhf2TiTHB7osVya" placeholder="QmeT9K2A9hqhtGa2RvXNopE6SD58gfvrhf2TiTHB7osVya" type="text">
        </div>
        <div>
            Version (your custom version):
            <input id="signVersion" value="v1.2.3" placeholder="v1.2.3" type="text">
        </div>
        <button id="signBtn">Sign</button>
    </form>
    Result:<br/>
    <textarea id="signResult" rows="10" cols="100"></textarea>
    <hr/>

    <h2>Validate signature</h2>
    <form>
        <div>
            <textarea id="validateSignature" rows="10" cols="100">{
  "contenthash": "0xe301701220ef64d0e6f7a121ce13f398c14c143aaf7fa861a216e433c4ad185c7286c6adb1",
  "version": "0x0000000000000000000000000000000000000000000000000001000200030000",
  "address": "0x384485D74cFBd5289B852824E6D1D8C4b77acab4",
  "sig": {
    "v": "0x1b",
    "r": "0x2d232751428def81f83bdda6d5a68cbac6d1e44024cd2e0f5aae14c9104235f2",
    "s": "0x5ad44c5de55b90665e4867d86ce1aabbf89c14678819ae327e5c4756e0438b99"
  }
}</textarea>
        </div>
        <button id="validateBtn">Validate</button>
    </form>
    Result:<br/>
    <textarea id="validateResult" rows="1" cols="100"></textarea>

    <script>

require.config({
  paths: {
    'web3': 'assets/js/web3',
    'ethereumjs-util': 'assets/js/ethereumjs-util',
    'ipfsSigner': 'js/index',
    'cids': 'node_modules/cids/dist/index'
  }
});

require(
  [
    'ipfsSigner',
    'web3'
  ],
  function(ipfsSigner, Web3){

    document.getElementById('signBtn').onclick = function(evt){
      evt.preventDefault();

      // clear
      document.getElementById('signResult').value = '';

      try {
        var web3 = new Web3();
        var accountSign = web3.eth.accounts.privateKeyToAccount('0x' + document.getElementById('signPrivateKey').value.replace(/^0x/,''));
        var cid = document.getElementById('signCid').value;
        var versionString = document.getElementById('signVersion').value;

        var contenthashHex = ipfsSigner.cidStringToContenthashHex(cid);
        var signatureData = ipfsSigner.signatureDataCreate(
          web3,
          accountSign,
          contenthashHex,
          ipfsSigner.versionStringToHex(versionString)
        );

        document.getElementById('signResult').value = JSON.stringify(signatureData, null, 2);
      
      } catch(err) {
        document.getElementById('signResult').value = 'Error';
      }
    };

    document.getElementById('validateBtn').onclick = function(evt){
      evt.preventDefault();

      // clear
      document.getElementById('validateResult').value = '';

      try {
        var web3 = new Web3();

        var success = ipfsSigner.signatureDataValidate(web3, JSON.parse(document.getElementById('validateSignature').value));
        document.getElementById('validateResult').value = (success? 'Validation success': 'Validation error');
      
      } catch (err){
        document.getElementById('validateResult').value = 'Error';
      }
    };

  }
);

    </script>
</body>
</html>
